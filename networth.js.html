
<script>
/**
 * NetWorthManager - Net Worth management component for SimBudget
 */
var NetWorthManager = (function() {
  // Private variables
  let _initialized = false;
  let _netWorthData = {
    summary: {},
    liquidAssets: [],
    investments: [],
    physicalAssets: [],
    debts: []
  };
  
  // Current date tracking
  let _currentMonth = '';
  let _currentYear = '';
  let _previousMonth = '';
  let _previousYear = '';
  
  // Real world current date
  let _realWorldCurrentDate = new Date();
  let _realWorldNextMonth = new Date(_realWorldCurrentDate);
  _realWorldNextMonth.setMonth(_realWorldCurrentDate.getMonth() + 1);
  
  // DOM element cache
  const _elements = {};
  
  /**
   * Get an element by ID with caching
   */
  function getElement(id) {
    if (!_elements[id]) {
      _elements[id] = document.getElementById(id);
    }
    return _elements[id];
  }
  
  /**
   * Initialize the Net Worth Manager
   */
  function init(containerId) {
    if (_initialized && !containerId) {
      console.log('NetWorthManager already initialized');
      return;
    }
    
    console.log('Initializing Net Worth Manager...');
    
    // Find container element
    const container = containerId ? 
      document.getElementById(containerId) : 
      getElement('netWorthContent');
    
    if (!container) {
      console.error('Net Worth container not found');
      return;
    }
    
    // Store container in elements cache
    _elements['netWorthContent'] = container;
    
    // Set default current month/year to real-world current month
    _currentMonth = new Intl.DateTimeFormat('en-US', { month: 'long' }).format(_realWorldCurrentDate);
    _currentYear = _realWorldCurrentDate.getFullYear();
    
    // Calculate previous month
    const prevDate = new Date(_realWorldCurrentDate);
    prevDate.setMonth(_realWorldCurrentDate.getMonth() - 1);
    _previousMonth = new Intl.DateTimeFormat('en-US', { month: 'long' }).format(prevDate);
    _previousYear = prevDate.getFullYear();
    
    // Load sample data for immediate display
    loadSampleData();
    initMonthYearSelector();
    // Render the net worth view
    renderNetWorthView();
    
    _initialized = true;
    console.log('Net Worth Manager initialized');
  }
  
  /**
   * Load sample data for initial display
   */
  function loadSampleData() {
    console.log('Loading sample net worth data');
    
    // Sample summary data
    _netWorthData.summary = {
      totalNetWorth: 127690,
      totalAssets: 131050,
      totalDebts: 3360,
      previousNetWorth: 128640,
      change: -950,
      currentMonth: _currentMonth,
      currentYear: _currentYear,
      previousMonth: _previousMonth,
      previousYear: _previousYear
    };
    
    // Sample liquid assets
    _netWorthData.liquidAssets = [
      { id: 'la1', type: 'Bank Account', name: 'Revolut', amount: 1400, previousAmount: 1400, change: '', changeAmount: 0, notes: '' },
      { id: 'la2', type: 'Bank Account', name: 'CIMB', amount: 2900, previousAmount: 2900, change: '', changeAmount: 0, notes: '' },
      { id: 'la3', type: 'Bank Account', name: 'Ziraat', amount: 2000, previousAmount: 2000, change: '', changeAmount: 0, notes: '' },
      { id: 'la4', type: 'Bank Account', name: 'N26', amount: 1250, previousAmount: 1250, change: '', changeAmount: 0, notes: '' },
      { id: 'la5', type: 'Bank Account', name: 'Sparkasse', amount: 2300, previousAmount: 2300, change: '', changeAmount: 0, notes: '' },
      { id: 'la6', type: 'Cash', name: 'USD & EUR', amount: 5500, previousAmount: 5500, change: '', changeAmount: 0, notes: '' }
    ];
    
    // Sample investments
    _netWorthData.investments = [
      { id: 'inv1', type: 'Crypto', name: 'Bitstamp', amount: 13750, previousAmount: 13750, change: '', changeAmount: 0, notes: '' },
      { id: 'inv2', type: 'Stocks', name: 'BIST', amount: 18500, previousAmount: 18500, change: '', changeAmount: 0, notes: '' },
      { id: 'inv3', type: 'Stocks', name: 'Trading212', amount: 4650, previousAmount: 4650, change: '', changeAmount: 0, notes: '' },
      { id: 'inv4', type: 'Stocks', name: 'eToro', amount: 45000, previousAmount: 45000, change: '', changeAmount: 0, notes: '' }
    ];
    
    // Sample physical assets
    _netWorthData.physicalAssets = [
      { id: 'pa1', type: 'Vehicles', name: 'BMW 530e', amount: 19000, previousAmount: 22000, change: '', changeAmount: 0, notes: '' }
    ];
    
    // Sample debts
    _netWorthData.debts = [
      { id: 'debt1', type: 'Loan', name: 'Car Loan', amount: 3360, previousAmount: 3360, change: '', changeAmount: 0, notes: '' }
    ];
  }
  
  /**
   * Get normalized date for current view
   * Sets the date to the 1st of the month for clean comparison
   */
  function getCurrentViewDate() {
    return new Date(_currentYear, getMonthNumber(_currentMonth), 1);
  }
  
  /**
   * Convert month name to month number (0-11)
   */
  function getMonthNumber(monthName) {
    const months = {
      'January': 0, 'February': 1, 'March': 2, 'April': 3,
      'May': 4, 'June': 5, 'July': 6, 'August': 7,
      'September': 8, 'October': 9, 'November': 10, 'December': 11
    };
    return months[monthName] || 0;
  }
  
  /**
   * Get month name from month number (0-11)
   */
  function getMonthName(monthNumber) {
    const months = [
      'January', 'February', 'March', 'April', 'May', 'June', 
      'July', 'August', 'September', 'October', 'November', 'December'
    ];
    return months[monthNumber] || 'January';
  }
  
  /**
   * Check if the current view is showing the real-world current month
   */
  function isCurrentRealMonth() {
    const viewDate = getCurrentViewDate();
    const realCurrentDate = new Date(_realWorldCurrentDate.getFullYear(), _realWorldCurrentDate.getMonth(), 1);
    
    return viewDate.getTime() === realCurrentDate.getTime();
  }
  
  /**
   * Check if the current view is showing the month after the real-world current month
   */
  function isNextRealMonth() {
    const viewDate = getCurrentViewDate();
    const realNextMonthDate = new Date(_realWorldNextMonth.getFullYear(), _realWorldNextMonth.getMonth(), 1);
    
    return viewDate.getTime() === realNextMonthDate.getTime();
  }
  

  /**
 * Initialize month-year selector for Net Worth view
 */
function initMonthYearSelector() {
  // Set up initial month/year display
  updateMonthYearDisplay();
  
  // Attach event listeners for month navigation buttons
  const prevMonthBtn = document.getElementById('prevMonthNetWorth');
  const nextMonthBtn = document.getElementById('nextMonthNetWorth');
  
  if (prevMonthBtn) {
    prevMonthBtn.addEventListener('click', function(e) {
      e.preventDefault();
      navigateMonth(-1);
    });
  }
  
  if (nextMonthBtn) {
    nextMonthBtn.addEventListener('click', function(e) {
      e.preventDefault();
      navigateMonth(1);
    });
  }
}

/**
 * Update month/year display text
 */
function updateMonthYearDisplay() {
  const displayElement = document.getElementById('monthYearDisplayNetWorth');
  if (displayElement) {
    displayElement.textContent = `${_currentMonth} ${_currentYear}`;
  }
}

  /**
   * Navigate to a different month
   * @param {number} direction - -1 for previous, 1 for next
   */
  function navigateMonth(direction) {
    console.log(`Navigating ${direction > 0 ? 'forward' : 'backward'} one month`);
    
    // Calculate target date
    const viewDate = getCurrentViewDate();
    viewDate.setMonth(viewDate.getMonth() + direction);
    
    // Get normalized dates for comparison
    const realCurrentDate = new Date(_realWorldCurrentDate.getFullYear(), _realWorldCurrentDate.getMonth(), 1);
    const realNextMonthDate = new Date(_realWorldNextMonth.getFullYear(), _realWorldNextMonth.getMonth(), 1);
    
    // Validate navigation - Never allow going beyond next month
    if (viewDate.getTime() > realNextMonthDate.getTime()) {
      console.log("Can't navigate beyond next month");
      return;
    }
    
    // Handle next month (future month) case
    if (viewDate.getTime() === realNextMonthDate.getTime()) {
      console.log("Navigating to next month - showing future month screen");
      
      // Get current real month as string for display
      const currentMonthName = getMonthName(realCurrentDate.getMonth());
      const nextMonthName = getMonthName(realNextMonthDate.getMonth());
        updateMonthYearDisplay();
      showFutureMonthScreen(
        nextMonthName,
        realNextMonthDate.getFullYear(),
        currentMonthName,
        realCurrentDate.getFullYear()
      );
      return;
    }
    
    // Normal month navigation
    _currentMonth = getMonthName(viewDate.getMonth());
    _currentYear = viewDate.getFullYear();
    
    // Calculate previous month
    const prevDate = new Date(viewDate);
    prevDate.setMonth(viewDate.getMonth() - 1);
    _previousMonth = getMonthName(prevDate.getMonth());
    _previousYear = prevDate.getFullYear();
    
    // Update data in our model
    _netWorthData.summary.currentMonth = _currentMonth;
    _netWorthData.summary.currentYear = _currentYear;
    _netWorthData.summary.previousMonth = _previousMonth;
    _netWorthData.summary.previousYear = _previousYear;
      updateMonthYearDisplay();
    // Re-render the view with the new month
    renderNetWorthView();
  }
  
  /**
   * Show an empty state for future months (next month)
   */
  function showFutureMonthScreen(month, year, prevMonth, prevYear) {
    console.log(`Showing future month screen for ${month} ${year}`);
    
    const container = getElement('netWorthContent');
    if (!container) return;
    
    container.innerHTML = `
 
      
      <div class="nw-future-message">
        <div class="nw-future-icon"><i class="material-icons">event_busy</i></div>
        <h3>No data exists for ${month} ${year} yet</h3>
        <p>You can only record net worth for the current month or the next month.</p>
        <button id="copyFromPrevBtn" class="nw-btn nw-btn-primary">
          <i class="material-icons">content_copy</i> Copy data from ${prevMonth} ${prevYear}
        </button>
      </div>
    `;
    
    // Explicitly bind event handlers
    const prevMonthBtn = document.getElementById('prevMonthBtn');
    if (prevMonthBtn) {
      prevMonthBtn.onclick = function(e) {
        e.preventDefault();
        navigateMonth(-1);
        return false;
      };
    }
    
    // Bind copy button
    const copyBtn = document.getElementById('copyFromPrevBtn');
    if (copyBtn) {
      copyBtn.onclick = function(e) {
        e.preventDefault();
        
        // Set the current view to the future month
        _currentMonth = month;
        _currentYear = year;
        _previousMonth = prevMonth;
        _previousYear = prevYear;
        
        // Update summary months
        _netWorthData.summary.currentMonth = month;
        _netWorthData.summary.currentYear = year;
        _netWorthData.summary.previousMonth = prevMonth;
        _netWorthData.summary.previousYear = prevYear;
        
        renderNetWorthView();
        
        // Show success message
        showMessage(`Data copied from ${prevMonth} successfully`, 'success');
        return false;
      };
    }
  }
  
  /**
   * Show modal for adding a new asset
   */
  function showAddAssetModal(category) {
    console.log('Showing add asset modal for', category);
    
    // Get container
    const container = getElement('netWorthContent');
    if (!container) return;
    
    // Create modal backdrop
    const backdrop = document.createElement('div');
    backdrop.className = 'nw-modal-backdrop';
    
    // Create modal content
    const modal = document.createElement('div');
    modal.className = 'nw-modal';
    
    // Set title based on category
    let title = 'Add New Asset';
    let typeOptions = '';
    
    switch(category) {
      case 'liquidAssets':
        title = 'Add Liquid Asset';
        typeOptions = `
          <option value="Bank Account">Bank Account</option>
          <option value="Cash">Cash</option>
          <option value="Money Market">Money Market</option>
          <option value="Other">Other Liquid Asset</option>
        `;
        break;
      case 'investments':
        title = 'Add Investment';
        typeOptions = `
          <option value="Stocks">Stocks</option>
          <option value="Crypto">Crypto</option>
          <option value="ETF">ETF</option>
          <option value="Bond">Bond</option>
          <option value="Other">Other Investment</option>
        `;
        break;
      case 'physicalAssets':
        title = 'Add Physical Asset';
        typeOptions = `
          <option value="Vehicle">Vehicle</option>
          <option value="Real Estate">Real Estate</option>
          <option value="Collection">Collection</option>
          <option value="Electronics">Electronics</option>
          <option value="Other">Other Physical Asset</option>
        `;
        break;
      case 'debts':
        title = 'Add Debt';
        typeOptions = `
          <option value="Credit Card">Credit Card</option>
          <option value="Loan">Loan</option>
          <option value="Mortgage">Mortgage</option>
          <option value="Other">Other Debt</option>
        `;
        break;
    }
    
    const monthYearDisplay = `${_currentMonth} ${_currentYear}`;
    
    // Create modal HTML
    modal.innerHTML = `
      <div class="nw-modal-header">
        <h3>${title}</h3>
        <button class="nw-modal-close">&times;</button>
      </div>
      <div class="nw-modal-body">
        <form class="nw-form" id="addAssetForm">
          <div class="nw-form-group">
            <label for="assetType">Type</label>
            <select id="assetType" class="nw-input" required>
              <option value="">-- Select Type --</option>
              ${typeOptions}
            </select>
          </div>
          <div class="nw-form-group">
            <label for="assetName">Name</label>
            <input type="text" id="assetName" class="nw-input" required placeholder="e.g., Revolut, Bitcoin">
          </div>
          <div class="nw-form-group">
            <label for="assetAmount">Value for ${monthYearDisplay}</label>
            <div class="nw-amount-wrapper">
              <span class="nw-currency">${getCurrencySymbol()}</span>
              <input type="number" id="assetAmount" class="nw-input nw-amount" required step="0.01" min="0">
            </div>
          </div>
          <div class="nw-form-group">
            <label for="assetNotes">Notes (Optional)</label>
            <textarea id="assetNotes" class="nw-input nw-textarea" rows="3"></textarea>
          </div>
        </form>
      </div>
      <div class="nw-modal-footer">
        <button class="nw-btn nw-btn-secondary" id="cancelAddAsset">Cancel</button>
        <button class="nw-btn nw-btn-primary" id="confirmAddAsset">Add</button>
      </div>
    `;
    
    // Add to container
    container.appendChild(backdrop);
    container.appendChild(modal);
    
    // Add event listeners
    modal.querySelector('.nw-modal-close').addEventListener('click', function() {
      container.removeChild(backdrop);
      container.removeChild(modal);
    });
    
    modal.querySelector('#cancelAddAsset').addEventListener('click', function() {
      container.removeChild(backdrop);
      container.removeChild(modal);
    });
    
    modal.querySelector('#confirmAddAsset').addEventListener('click', function() {
      // Get form values
      const type = modal.querySelector('#assetType').value;
      const name = modal.querySelector('#assetName').value;
      const amount = parseFloat(modal.querySelector('#assetAmount').value);
      const notes = modal.querySelector('#assetNotes').value;
      
      // Basic validation
      if (!type || !name || isNaN(amount)) {
        alert('Please fill in all required fields');
        return;
      }
      
      // Create new asset object
      const newAsset = {
        id: `new-${Date.now()}`,
        type: type,
        name: name,
        amount: amount,
        previousAmount: 0,
        change: 'New',
        changeAmount: amount,
        notes: notes || ''
      };
      
      // Add to appropriate category
      _netWorthData[category].push(newAsset);
      
      // Close modal
      container.removeChild(backdrop);
      container.removeChild(modal);
      
      // Re-render
      renderNetWorthView();
      
      // Show success message
      showMessage(`${type}: ${name} added successfully`, 'success');
    });
  }
  
  /**
   * Show notes modal for an asset
   */
  function showNotesModal(id, category) {
    console.log(`Showing notes modal for ${id} in ${category}`);
    
    // Find the asset
    const asset = _netWorthData[category].find(item => item.id === id);
    if (!asset) return;
    
    // Get container
    const container = getElement('netWorthContent');
    if (!container) return;
    
    // Create modal backdrop
    const backdrop = document.createElement('div');
    backdrop.className = 'nw-modal-backdrop';
    
    // Create modal content
    const modal = document.createElement('div');
    modal.className = 'nw-modal nw-notes-modal';
    
    // Create modal HTML
    modal.innerHTML = `
      <div class="nw-modal-header">
        <h3>Notes for ${asset.name}</h3>
        <button class="nw-modal-close">&times;</button>
      </div>
      <div class="nw-modal-body">
        <textarea class="nw-input nw-textarea" id="assetNotes" rows="5">${asset.notes || ''}</textarea>
      </div>
      <div class="nw-modal-footer">
        <button class="nw-btn nw-btn-secondary" id="cancelNotes">Cancel</button>
        <button class="nw-btn nw-btn-primary" id="saveNotes">Save Notes</button>
      </div>
    `;
    
    // Add to container
    container.appendChild(backdrop);
    container.appendChild(modal);
    
    // Add event listeners
    modal.querySelector('.nw-modal-close').addEventListener('click', function() {
      container.removeChild(backdrop);
      container.removeChild(modal);
    });
    
    modal.querySelector('#cancelNotes').addEventListener('click', function() {
      container.removeChild(backdrop);
      container.removeChild(modal);
    });
    
    modal.querySelector('#saveNotes').addEventListener('click', function() {
      // Get notes value
      const notes = modal.querySelector('#assetNotes').value;
      
      // Update the asset
      asset.notes = notes;
      
      // Close modal
      container.removeChild(backdrop);
      container.removeChild(modal);
      
      // No need to re-render as notes aren't displayed in the main view
      
      // Show success message
      showMessage('Notes saved successfully', 'success');
    });
  }
  
  /**
   * Remove an asset
   */
  function removeAsset(id, category) {
    console.log(`Removing asset ${id} from ${category}`);
    
    // Find the asset index
    const index = _netWorthData[category].findIndex(item => item.id === id);
    if (index === -1) return;
    
    // Get asset info for confirmation message
    const asset = _netWorthData[category][index];
    
    // Confirm deletion
    if (confirm(`Are you sure you want to remove ${asset.name}?`)) {
      // Remove from array
      _netWorthData[category].splice(index, 1);
      
      // Re-render
      renderNetWorthView();
      
      // Show success message
      showMessage(`${asset.name} removed successfully`, 'success');
    }
  }
  
  /**
   * Show a status message
   */
  function showMessage(message, type = 'info') {
    const messageContainer = getElement('netWorthMessage');
    if (!messageContainer) return;
    
    // Set message content and type
    messageContainer.textContent = message;
    messageContainer.className = `nw-message nw-${type}-message`;
    
    // Show the message
    messageContainer.style.display = 'block';
    
    // Hide after delay
    setTimeout(() => {
      messageContainer.style.display = 'none';
    }, 3000);
  }
  
  /**
   * Get currency symbol from settings
   */
  function getCurrencySymbol() {
    // Use the Utils function if available, otherwise default to €
    if (typeof Utils !== 'undefined' && Utils.getCurrencySymbol) {
      return Utils.getCurrencySymbol();
    }
    return '€';
  }
  
  /**
   * Format currency
   */
  function formatCurrency(amount) {
    // Use the Utils function if available
    if (typeof Utils !== 'undefined' && Utils.formatCurrency) {
      return Utils.formatCurrency(amount);
    }
    
    // Simple default formatter
    const symbol = getCurrencySymbol();
    return `${symbol}${Math.abs(amount).toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0})}`;
  }
  
  /**
   * Render the net worth view
   */
  function renderNetWorthView() {
    console.log('Rendering Net Worth view');
    
    const container = getElement('netWorthContent');
    if (!container) return;
    
    // Format month/year for display
    const monthYearDisplay = `${_currentMonth} ${_currentYear}`;
    
    // Create HTML structure
    container.innerHTML = `
      <div class="nw-message" id="netWorthMessage" style="display: none;"></div>
      

      
      <div class="nw-summary-card">
        <div class="nw-summary-content">
          <div class="nw-summary-item">
            <div class="nw-summary-label">Net Worth</div>
            <div class="nw-summary-value">${formatCurrency(_netWorthData.summary.totalNetWorth)}</div>
            <div class="nw-summary-change ${_netWorthData.summary.change >= 0 ? 'nw-positive' : 'nw-negative'}">
              (${formatCurrency(_netWorthData.summary.change)})
            </div>
          </div>
          <div class="nw-summary-item">
            <div class="nw-summary-label">Total Assets</div>
            <div class="nw-summary-value">${formatCurrency(_netWorthData.summary.totalAssets)}</div>
          </div>
          <div class="nw-summary-item">
            <div class="nw-summary-label">Total Debts</div>
            <div class="nw-summary-value">${formatCurrency(_netWorthData.summary.totalDebts)}</div>
          </div>
        </div>
      </div>
      
      ${renderCategorySection('Liquid Assets', 'liquidAssets')}
      ${renderCategorySection('Investments', 'investments')}
      ${renderCategorySection('Physical Assets', 'physicalAssets')}
      ${renderCategorySection('Debts', 'debts')}
    `;
    
    // Bind event handlers for navigation - direct approach with no debouncing
    const prevMonthBtn = document.getElementById('prevMonthBtn');
    if (prevMonthBtn) {
      prevMonthBtn.onclick = function(e) {
        e.preventDefault();
        navigateMonth(-1);
        return false;
      };
    }
    
    const nextMonthBtn = document.getElementById('nextMonthBtn');
    if (nextMonthBtn) {
      nextMonthBtn.onclick = function(e) {
        e.preventDefault();
        navigateMonth(1);
        return false;
      };
    }
    
    // Bind category add buttons
    document.querySelectorAll('.nw-add-btn').forEach(btn => {
      btn.onclick = function(e) {
        e.preventDefault();
        const category = this.getAttribute('data-category');
        if (category) {
          showAddAssetModal(category);
        }
        return false;
      };
    });
    
    // Set up editable fields
    setupEditableFields();
  }
  
  /**
   * Render a category section with its assets
   */
  function renderCategorySection(title, category) {
    return `
      <div class="nw-section">
        <div class="nw-section-header">
          <h3 class="nw-section-title">${title}</h3>
          <button class="nw-add-btn" data-category="${category}">
            <i class="material-icons">add_circle_outline</i> Add
          </button>
        </div>
        ${renderAssetTable(category)}
      </div>
    `;
  }
  
  /**
   * Render asset table for a category
   */
  function renderAssetTable(category) {
    if (!_netWorthData[category] || _netWorthData[category].length === 0) {
      return `
        <div class="nw-empty-state">
          <p>No ${category.replace(/([A-Z])/g, ' $1').toLowerCase()} found. Click Add to create one.</p>
        </div>
      `;
    }
    
    // Determine if this is the debts section to handle negative values
    const isDebt = category === 'debts';
    
    // Always show change details
    return `
      <div class="nw-table-container">
        <table class="nw-table">
          <thead>
            <tr>
              <th>Type</th>
              <th>Name</th>
              <th>Amount</th>
              <th>Change</th>
              <th>Change Amount</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${_netWorthData[category].map(item => {
              // Format the value based on whether it's a debt
              const formattedValue = formatCurrency(isDebt ? -item.amount : item.amount);
              
              return `
                <tr data-id="${item.id}">
                  <td class="nw-type-cell">${item.type}</td>
                  <td class="nw-name-cell">${item.name}</td>
                  <td class="nw-value-cell">
                    <div class="nw-editable" data-field="amount" data-id="${item.id}" data-category="${category}">
                      ${formattedValue}
                    </div>
                  </td>
                  <td class="nw-change-cell">
                    <select class="nw-change-select" data-id="${item.id}" data-category="${category}">
                      <option value=""></option>
                      <option value="Deposit" ${item.change === 'Deposit' ? 'selected' : ''}>Deposit</option>
                      <option value="Withdrawal" ${item.change === 'Withdrawal' ? 'selected' : ''}>Withdrawal</option>
                      <option value="Transfer" ${item.change === 'Transfer' ? 'selected' : ''}>Transfer</option>
                      <option value="Interest" ${item.change === 'Interest' ? 'selected' : ''}>Interest</option>
                      <option value="Fee" ${item.change === 'Fee' ? 'selected' : ''}>Fee</option>
                      <option value="New" ${item.change === 'New' ? 'selected' : ''}>New</option>
                    </select>
                  </td>
                  <td class="nw-change-amount-cell">
                    <div class="nw-editable" data-field="changeAmount" data-id="${item.id}" data-category="${category}">
                      ${item.changeAmount ? formatCurrency(item.changeAmount) : ''}
                    </div>
                  </td>
                  <td class="nw-actions-cell">
                    <button class="nw-action-btn nw-notes-btn" data-id="${item.id}" data-category="${category}" title="Notes">
                      <i class="material-icons">description</i>
                    </button>
                    <button class="nw-action-btn nw-delete-btn" data-id="${item.id}" data-category="${category}" title="Remove">
                      <i class="material-icons">close</i>
                    </button>
                  </td>
                </tr>
              `;
            }).join('')}
          </tbody>
        </table>
      </div>
    `;
  }
  
  /**
   * Set up editable fields after rendering
   */
  function setupEditableFields() {
    // Set up editable field handlers
    document.querySelectorAll('.nw-editable').forEach(el => {
      el.addEventListener('click', function() {
        const field = this.getAttribute('data-field');
        const id = this.getAttribute('data-id');
        const category = this.getAttribute('data-category');
        
        const asset = _netWorthData[category].find(item => item.id === id);
        if (!asset) return;
        
        // Determine if we're editing a debt value (should be negative)
        const isDebt = category === 'debts' && field === 'amount';
        
        // Get current value (use absolute value for display in debt fields)
        const currentValue = field === 'amount' 
          ? (isDebt ? -asset.amount : asset.amount) 
          : (asset.changeAmount || 0);
        
        // Replace with input field
        const originalContent = this.innerHTML;
        this.innerHTML = `
          <div class="nw-edit-wrapper">
            <span class="nw-edit-currency">${getCurrencySymbol()}</span>
            <input type="number" class="nw-edit-input" value="${currentValue}" step="0.01" min="0">
          </div>
        `;
        
        // Focus the input
        const input = this.querySelector('input');
        input.focus();
        input.select();
        
        // Save on blur
        input.addEventListener('blur', function() {
          let newValue = parseFloat(this.value);
          
          // Validate
          if (isNaN(newValue) || newValue < 0) {
            // Revert to original content on invalid input
            el.innerHTML = originalContent;
            return;
          }
          
          // Update the value (make debts negative in the data)
          if (field === 'amount') {
            asset.amount = isDebt ? -newValue : newValue;
          } else {
            asset.changeAmount = newValue;
          }
          
          // Update the display
          el.innerHTML = formatCurrency(newValue);
          
          // Show save indicator
          el.classList.add('nw-saving');
          
          // Simulate API save
          setTimeout(() => {
            el.classList.remove('nw-saving');
            el.classList.add('nw-saved');
            
            setTimeout(() => {
              el.classList.remove('nw-saved');
            }, 1000);
          }, 500);
        });
        
        // Handle Enter key
        input.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' || e.key === 'Tab') {
            this.blur();
            e.preventDefault();
          }
        });
      });
    });
    
    // Set up change dropdown handlers
    document.querySelectorAll('.nw-change-select').forEach(select => {
      select.addEventListener('change', function() {
        const id = this.getAttribute('data-id');
        const category = this.getAttribute('data-category');
        
        const asset = _netWorthData[category].find(item => item.id === id);
        if (!asset) return;
        
        // Update the value
        asset.change = this.value;
        
        // Show save indicator
        this.classList.add('nw-saving');
        
        // Simulate API save
        setTimeout(() => {
          this.classList.remove('nw-saving');
          this.classList.add('nw-saved');
          
          setTimeout(() => {
            this.classList.remove('nw-saved');
          }, 1000);
        }, 500);
      });
    });
    
    // Set up notes button handlers
    document.querySelectorAll('.nw-notes-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const id = this.getAttribute('data-id');
        const category = this.getAttribute('data-category');
        
        showNotesModal(id, category);
      });
    });
    
    // Set up delete button handlers
    document.querySelectorAll('.nw-delete-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const id = this.getAttribute('data-id');
        const category = this.getAttribute('data-category');
        
        removeAsset(id, category);
      });
    });
  }
  
  /**
   * Set net worth data from external source
   */
  function setNetWorthData(data) {
    console.log('Setting net worth data from external source');
    
    if (!data) return;
    
    // Update data
    if (data.summary) _netWorthData.summary = data.summary;
    if (data.liquidAssets) _netWorthData.liquidAssets = data.liquidAssets;
    if (data.investments) _netWorthData.investments = data.investments;
    if (data.physicalAssets) _netWorthData.physicalAssets = data.physicalAssets;
    if (data.debts) _netWorthData.debts = data.debts;
    
    // Update month/year if present in data
    if (data.summary?.currentMonth) _currentMonth = data.summary.currentMonth;
    if (data.summary?.currentYear) _currentYear = data.summary.currentYear;
    if (data.summary?.previousMonth) _previousMonth = data.summary.previousMonth;
    if (data.summary?.previousYear) _previousYear = data.summary.previousYear;
    
    // Re-render
    renderNetWorthView();
  }
  
  // Public API
  return {
    init: init,
    renderNetWorthView: renderNetWorthView,
    setNetWorthData: setNetWorthData
  };
})();

// Expose globally without auto-initialization
window.NetWorthManager = NetWorthManager;

/**
 * Load net worth data with simplified reliable rendering
 */
SimBudget.loadNetWorthData = function() {
  console.log("Loading net worth view...");
  
  const contentArea = document.getElementById("netWorthContent");
  if (!contentArea) {
    console.error("Net Worth content area not found");
    _loadingView = null;
    return;
  }

  // Show simple loading state
  contentArea.innerHTML = `
    <div class="nw-loading">
      <div class="loading-spinner"></div>
      <p class="nw-loading-text">Loading net worth data...</p>
    </div>
  `;
  
  // Initialize NetWorthManager directly - this will replace the loading state
  setTimeout(() => {
    if (window.NetWorthManager && typeof NetWorthManager.init === 'function') {
      console.log("Initializing NetWorthManager");
      // Explicitly pass the container ID to ensure proper rendering
      NetWorthManager.init('netWorthContent');
      
      // After UI is shown with sample data, try to fetch real data in background
      if (window.API && typeof API.getNetWorthData === 'function') {
        console.log("Fetching real net worth data in background...");
        
        API.getNetWorthData(
          function(result) {
            console.log("Real net worth data loaded successfully");
            
            // Update UI with real data if available
            if (result && result.success && result.netWorth) {
              NetWorthManager.setNetWorthData(result.netWorth);
            }
            
            // Cache the result
            if (window._cache && typeof _cache.set === 'function') {
              _cache.set("netWorth", result.netWorth || {});
            }
          },
          function(error) {
            console.log("Using sample data - couldn't load real data:", error);
            // Just log the error - user already sees sample data
          }
        );
      }
    } else {
      contentArea.innerHTML = '<div class="error-message">Error: Net Worth Manager component not available</div>';
      console.error("NetWorthManager component not found");
    }
    
    // Clear loading flag
    _loadingView = null;
  }, 300); // Small timeout to ensure DOM is ready
};
</script>

<style>
/* ==============================================================
   NET WORTH MANAGEMENT - DASHBOARD STYLE MATCHING
   ==============================================================
   All classes use the 'nw-' prefix to avoid conflicts.
   Mobile-first approach with desktop adjustments after.
   Matching dashboard's signature border style and color scheme.
*/

/* ======== LOADING ======== */
.nw-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px;
  text-align: center;
}

.nw-loading-text {
  margin-top: 16px;
  color: var(--text-secondary, #666);
}

/* ======== MESSAGES ======== */
.nw-message {
  padding: 12px 16px;
  border-radius: 0px;
  margin-bottom: 16px;
  font-weight: 500;
  border-top: 1px solid rgba(0, 0, 0, 0.5);
  border-left: 1px solid rgba(0, 0, 0, 0.5);
  border-right: 4px solid #334a60;
  border-bottom: 4px solid #334a60;
}

.nw-success-message {
  background-color: #e8f5e9;
  color: #2e7d32;
}

.nw-error-message {
  background-color: #ffebee;
  color: #d32f2f;
}

.nw-info-message {
  background-color: #e3f2fd;
  color: #1976d2;
}

/* ======== SUMMARY CARD ======== */
.nw-summary-card {
  background-color: #fe9aa1;
  border-radius: 0px;
  margin-bottom: 16px;
  padding: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.5);
  border-left: 1px solid rgba(0, 0, 0, 0.5);
  border-right: 4px solid #334a60;
  border-bottom: 4px solid #334a60;
  padding: 10px 70px;
  margin-top: 20px;
}

.nw-summary-content {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
}

.nw-summary-item {
  text-align: center;
  flex: 1;
  min-width: 0;
  padding: 0 8px;
}

.nw-summary-label {
  font-size: 12px;
  color: black;
  margin-bottom: 4px;
  font-family: sans-serif;
}

.nw-summary-value {
  font-size: 20px;
  font-weight: 600;
  color: #2c3e50;
  font-family: 'Lato', sans-serif;
  font-weight: 700;
}

.nw-summary-change {
  font-size: 14px;
  font-weight: 500;
  margin-top: 2px;
  font-family: 'Lato', sans-serif;
  font-weight: 700;
}

.nw-positive {
  color: #4caf50;
}

.nw-negative {
  color: #f44336;
}

/* ======== OPTIONS ======== */
.nw-options {
  display: flex;
  align-items: center;
  margin-bottom: 16px;
}

.nw-checkbox {
  display: flex;
  align-items: center;
  cursor: pointer;
}

.nw-checkbox input {
  margin-right: 8px;
}

.nw-checkbox-text {
  font-size: 13px;
}

/* ======== CATEGORY SECTIONS ======== */
.nw-section {
  background-color: #ffffff;
  border-radius: 0px;
  margin-bottom: 16px;
  border-top: 1px solid rgba(0, 0, 0, 0.5);
  border-left: 1px solid rgba(0, 0, 0, 0.5);
  border-right: 4px solid #334a60;
  border-bottom: 4px solid #334a60;
  overflow: hidden;
  padding: 10px 70px;
}

.nw-section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 12px;
  background-color: #f8f8f8;
  border-bottom: 1px solid #eee;
}

.nw-section-title {
  margin: 0;
  font-size: 14px;
  font-weight: 500;
  font-family: 'Lato', sans-serif;
  font-weight: 700;
}

.nw-add-btn {
  background: none;
  border: none;
  color: #2c3e50;
  cursor: pointer;
  font-size: 13px;
  display: flex;
  align-items: center;
  padding: 4px 8px;
  border-radius: 0px;
  transition: background-color 0.2s;
}

.nw-add-btn:hover {
  background-color: rgba(0,0,0,0.04);
}

.nw-add-btn i {
  font-size: 16px;
  margin-right: 4px;
}

.nw-empty-state {
  padding: 20px;
  text-align: center;
  color: var(--text-secondary, #666);
  font-size: 13px;
}

/* ======== TABLE ======== */
.nw-table-container {
  overflow-x: auto;
}

.nw-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}

.nw-table th,
.nw-table td {
  padding: 12px 6px;
  text-align: left;
  border-bottom: 1px solid #eee;
}

.nw-table th {
  font-weight: 500;
  color: var(--text-secondary, #666);
  font-size: 12px;
  background-color: white;
  position: sticky;
  top: 0;
  z-index: 1;
  font-family: 'Lato', sans-serif;
  font-weight: 700;
}

.nw-type-cell {
  width: 18%;
  white-space: nowrap;
}

.nw-name-cell {
  width: 30%;
}

.nw-value-cell {
  width: 18%;
  text-align: right;
  white-space: nowrap;
  font-family: 'Lato', sans-serif;
  font-weight: 700;
}

.nw-change-cell {
  width: 15%;
}

.nw-change-amount-cell {
  width: 14%;
  text-align: right;
  white-space: nowrap;
  font-family: 'Lato', sans-serif;
  font-weight: 700;
}

.nw-actions-cell {
  width: 10%;
  white-space: nowrap;
  text-align: right;
}

.nw-action-btn {
  background: none;
  border: none;
  cursor: pointer;
  color: #666;
  width: 24px;
  height: 24px;
  padding: 0;
  font-size: 13px;
  border-radius: 0px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s;
}

.nw-action-btn:hover {
  background-color: rgba(0,0,0,0.04);
}

.nw-delete-btn {
  color: var(--error, #f44336);
}

.nw-notes-btn {
  color: var(--text-secondary, #666);
}

.nw-action-btn i {
  font-size: 16px;
}

/* Editable fields */
.nw-editable {
  cursor: pointer;
  border-radius: 0px;
  padding: 8px 5px;
  display: inline-block;
  min-width: 60px;
  transition: background-color 0.2s;
  font-family: 'Lato', sans-serif;
  font-weight: 700;
}

.nw-editable:hover {
  background-color: rgba(0,0,0,0.04);
}

.nw-edit-wrapper {
  display: flex;
  align-items: center;
}

.nw-edit-currency {
  margin-right: 4px;
  font-family: 'Lato', sans-serif;
  font-weight: 700;
}

.nw-edit-input {
  background: transparent;
  border: none;
  outline: none;
  width: 100%;
  text-align: right;
  padding: 0;
  font-size: 13px;
  font-family: 'Lato', sans-serif;
  font-weight: 700;
}

/* Change tracking */
.nw-change-select {
  width: 100%;
  padding: 4px 6px;
  border: 1px solid #ddd;
  border-radius: 0px;
  font-size: 12px;
  background-color: white;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}

/* Add a custom dropdown arrow that only shows on hover */
.nw-change-cell {
  position: relative;
}

.nw-change-cell:hover::after {
  content: '▾';
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
  color: #666;
}

/* Saving indicators */
.nw-saving {
  position: relative;
  opacity: 0.7;
}

.nw-saving::after {
  content: '';
  position: absolute;
  top: 50%;
  right: 4px;
  transform: translateY(-50%);
  width: 8px;
  height: 8px;
  border: 2px solid #1976d2;
  border-top-color: transparent;
  border-radius: 50%;
  animation: nw-spin 1s linear infinite;
}

.nw-saved {
  background-color: rgba(76, 175, 80, 0.1);
  transition: background-color 0.5s;
}

@keyframes nw-spin {
  0% { transform: translateY(-50%) rotate(0deg); }
  100% { transform: translateY(-50%) rotate(360deg); }
}

/* ======== MODAL ======== */
.nw-modal-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 1000;
}

.nw-modal {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: white;
  border-radius: 0px;
  border-top: 1px solid rgba(0, 0, 0, 0.5);
  border-left: 1px solid rgba(0, 0, 0, 0.5);
  border-right: 4px solid #334a60;
  border-bottom: 4px solid #334a60;
  width: 90%;
  max-width: 400px;
  z-index: 1001;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.nw-notes-modal {
  max-width: 350px;
}

.nw-modal-header {
  padding: 12px;
  border-bottom: 1px solid #eee;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.nw-modal-header h3 {
  margin: 0;
  font-size: 16px;
  font-weight: 500;
  font-family: 'Lato', sans-serif;
  font-weight: 700;
}

.nw-modal-close {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: var(--text-secondary, #666);
}

.nw-modal-body {
  padding: 12px;
  max-height: 70vh;
  overflow-y: auto;
}

.nw-modal-footer {
  padding: 12px;
  border-top: 1px solid #eee;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

/* ======== FORM ======== */
.nw-form-group {
  margin-bottom: 12px;
}

.nw-form-group label {
  display: block;
  margin-bottom: 6px;
  font-weight: 500;
  font-size: 13px;
  font-family: 'Lato', sans-serif;
  font-weight: 700;
}

.nw-input {
  width: 100%;
  padding: 8px 10px;
  border: 1px solid #ddd;
  border-radius: 0px;
  font-size: 13px;
}

.nw-textarea {
  resize: vertical;
  min-height: 80px;
}

.nw-amount-wrapper {
  position: relative;
}

.nw-currency {
  position: absolute;
  left: 10px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-secondary, #666);
  font-family: 'Lato', sans-serif;
  font-weight: 700;
}

.nw-amount {
  padding-left: 24px;
  font-family: 'Lato', sans-serif;
  font-weight: 700;
}

/* ======== BUTTONS ======== */
.nw-btn {
  padding: 6px 12px;
  border-radius: 0px;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  border: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s;
}

.nw-btn i {
  margin-right: 6px;
  font-size: 16px;
}

.nw-btn-primary {
  background-color: #2c3e50;
  color: white;
}

.nw-btn-primary:hover {
  background-color: #1e2b37;
}

.nw-btn-secondary {
  background-color: transparent;
  border: 1px solid #2c3e50;
  color: #2c3e50;
}

.nw-btn-secondary:hover {
  background-color: rgba(44, 62, 80, 0.05);
}

/* ======== FUTURE MONTH SCREEN ======== */
.nw-future-message {
  text-align: center;
  padding: 40px 20px;
  background-color: white;
  border-radius: 0px;
  border-top: 1px solid rgba(0, 0, 0, 0.5);
  border-left: 1px solid rgba(0, 0, 0, 0.5);
  border-right: 4px solid #334a60;
  border-bottom: 4px solid #334a60;
  margin-top: 16px;
}

.nw-future-icon {
  margin-bottom: 16px;
  font-size: 24px;
  color: var(--text-secondary, #666);
}

.nw-future-icon i {
  font-size: 48px;
}

.nw-future-message h3 {
  margin: 0 0 8px;
  font-size: 16px;
  font-weight: 500;
  font-family: 'Lato', sans-serif;
  font-weight: 700;
}

.nw-future-message p {
  margin: 0 0 24px;
  color: var(--text-secondary, #666);
  font-size: 14px;
}

/* ======== DARK MODE SUPPORT ======== */
/* Main cards - coral cards become dark in dark mode */
body.dark-mode .nw-month-nav,
body.dark-mode .nw-summary-card {
  background-color: var(--dark-surface, #1e1e1e) !important;
  color: var(--dark-text-primary, rgba(255, 255, 255, 0.87)) !important;
}

/* White data cards stay dark */
body.dark-mode .nw-section,
body.dark-mode .nw-modal,
body.dark-mode .nw-future-message {
  background-color: var(--dark-surface, #1e1e1e);
  color: var(--dark-text-primary, rgba(255, 255, 255, 0.87));
}

body.dark-mode .nw-section-header {
  background-color: var(--dark-surface, #2c2c2e);
  border-color: var(--dark-border, rgba(255, 255, 255, 0.12));
}

/* Labels and secondary text */
body.dark-mode .nw-summary-label,
body.dark-mode .nw-section-title,
body.dark-mode .nw-table th,
body.dark-mode .nw-form-group label {
  color: var(--dark-text-secondary, rgba(255, 255, 255, 0.6)) !important;
}

/* Values and important numbers - golden color like dashboard */
body.dark-mode .nw-summary-value,
body.dark-mode .nw-value-cell,
body.dark-mode .nw-change-amount-cell,
body.dark-mode .nw-editable {
  color: #DDA15E !important;
}

/* Month navigation title */
body.dark-mode .nw-month-title {
  color: var(--dark-text-primary, rgba(255, 255, 255, 0.87)) !important;
}

/* Table and borders */
body.dark-mode .nw-table td {
  border-color: var(--dark-border, rgba(255, 255, 255, 0.12));
}

body.dark-mode .nw-table th {
  background-color: var(--dark-surface, #1e1e1e);
}

/* Modal styling */
body.dark-mode .nw-modal-header,
body.dark-mode .nw-modal-footer {
  border-color: var(--dark-border, rgba(255, 255, 255, 0.12));
}

/* Form elements */
body.dark-mode .nw-input,
body.dark-mode .nw-change-select {
  background-color: var(--dark-surface, #2c2c2e);
  border-color: var(--dark-border, rgba(255, 255, 255, 0.12));
  color: var(--dark-text-primary, rgba(255, 255, 255, 0.87));
}

body.dark-mode .nw-edit-input {
  color: var(--dark-text-primary, rgba(255, 255, 255, 0.87));
}

/* Currency symbols */
body.dark-mode .nw-currency,
body.dark-mode .nw-edit-currency {
  color: rgba(255, 255, 255, 0.6) !important;
}

/* Button styling */
body.dark-mode .nw-btn-secondary {
  border-color: #DDA15E;
  color: #DDA15E;
}

body.dark-mode .nw-btn-primary {
  background-color: #DDA15E;
  color: #1e1e1e;
}

body.dark-mode .nw-btn-primary:hover {
  background-color: #c9955a;
}

/* Interactive elements */
body.dark-mode .nw-editable:hover,
body.dark-mode .nw-action-btn:hover,
body.dark-mode .nw-add-btn:hover,
body.dark-mode .nw-month-btn:hover {
  background-color: rgba(255, 255, 255, 0.08);
}

body.dark-mode .nw-saved {
  background-color: rgba(76, 175, 80, 0.08);
}

/* Navigation and action buttons text color */
body.dark-mode .nw-month-btn,
body.dark-mode .nw-add-btn {
  color: rgba(255, 255, 255, 0.87) !important;
}

/* Positive/negative indicators */
body.dark-mode .nw-positive {
  color: #66bb6a !important;
}

body.dark-mode .nw-negative {
  color: #ef5350 !important;
}

/* ======== RESPONSIVE DESIGN ======== */
@media (max-width: 768px) {
  .nw-summary-content {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    flex-wrap: nowrap;
    gap: 8px;
  }
  
  .nw-summary-item {
    flex: 1;
    text-align: center;
    padding: 8px 4px;
  }
  
  .nw-summary-label {
    font-size: 12px;
    margin-bottom: 4px;
  }
  
  .nw-summary-value {
    font-size: 16px;
  }
  
  .nw-summary-change {
    font-size: 12px;
  }
  
  /* Hide certain columns on mobile */
  .nw-table .nw-change-cell,
  .nw-table .nw-change-amount-cell,
  .nw-table th:nth-child(4),
  .nw-table th:nth-child(5) {
    display: none;
  }
  
  /* Adjust remaining columns */
  .nw-type-cell {
    width: 30%;
  }
  
  .nw-name-cell {
    width: 40%;
  }
  
  .nw-value-cell {
    width: 30%;
  }
  
  /* Make the add button more compact */
  .nw-add-btn span {
    display: none;
  }
  
  .nw-add-btn i {
    margin-right: 0;
  }
  
  /* Make month navigation buttons more compact */
  .nw-month-btn span {
    display: none;
  }
  
  /* Make action buttons more accessible */
  .nw-actions-cell {
    width: auto;
  }
  
  .nw-action-btn {
    width: 36px;
    height: 36px;
  }
  
  .nw-action-btn i {
    font-size: 20px;
  }
  
  /* Ensure the table fits mobile view */
  .nw-table {
    table-layout: fixed;
    width: 100%;
  }
  
  .nw-table-container {
    overflow-x: visible;
  }
}

@media (min-width: 769px) {
  .nw-summary-card,
  .nw-section {
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }
  
  .nw-options {
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }
  
  .nw-month-nav {
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }
}

/* ======== PRINT STYLES ======== */
@media print {
  .nw-summary-card,
  .nw-section {
    border: 1px solid #ccc;
    break-inside: avoid;
    
  }
  
  .nw-options,
  .nw-add-btn,
  .nw-month-btn {
    display: none;
  }
  
  .nw-action-btn {
    display: none;
  }
  
  .nw-editable {
    cursor: text;
  }
  
  .nw-month-nav {
    break-after: avoid;
  }
}


</style>