
<script>
// MINIMAL CACHE RESET - PRESERVES SETTINGS & CATEGORIES
(function() {
  // Clear specific caches only
  ['expense', 'monthly', 'dashboard', 'budget_data'].forEach(pattern => {
    for (let i = localStorage.length-1; i >= 0; i--) {
      const key = localStorage.key(i);
      if (key && key.includes(pattern) && 
          !key.includes('setting') && 
          !key.includes('categories')) {
        localStorage.removeItem(key);
      }
    }
  });
  
  // Reset session tracking
  sessionStorage.removeItem('monthlyGrid_sessionActive');
  
  // Signal fresh data needed
  window.FORCE_FRESH_DATA = true;
})();


</script>

<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    
    <!-- Chart.js for data visualization -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
  <?!= include('Styles'); ?>
    
 <title data-translate="app_title">Simplify</title>
  </head>
  <body>


    <div class="app-container">
      <!-- SIDEBAR -->
      <?!= include('Sidebar'); ?>
      
      <!-- MAIN CONTENT AREA -->
      <div id="contentArea" class="content-area">
        <!-- Default content on load - Budget View -->
        <?!= include('dashboard.html'); ?>
        
                 <!-- Expense View - Using Grid by Default -->
          <div id="expenseView" class="view">
          <div class="view-header">
            <h1><i class="material-icons">receipt_long</i> <span data-translate="expenses">Expenses</span></h1>
            <div class="view-actions">
              <!-- Month/Year Selector -->
              <div class="month-selector">
                <button id="prevMonth" class="month-nav-btn" aria-label="Previous month">
                  <i class="material-icons">chevron_left</i>
                </button>
                <div id="monthYearDisplay" class="month-year-display">
                  <!-- Will be populated by JS -->
                </div>
                <button id="nextMonth" class="month-nav-btn" aria-label="Next month">
                  <i class="material-icons">chevron_right</i>
                </button>
              </div>
              <!-- Updated to match budget dashboard style -->
          <button id="refreshExpenses" class="btn icon-btn">
            <i class="material-icons">refresh</i>
          </button>
                </div>
              </div>
            
            <!-- The expense content is now directly the grid view -->
            <div id="expenseContent" class="view-content">
              <!-- The monthly grid component will load here -->
      
            </div>
          </div>
        
       <!-- Income View - Initially Hidden -->
        <div id="incomeView" class="view">
          <div class="view-header">
            <h1><i class="material-icons">payments</i> <span data-translate="income_title">Income</span></h1>
            <div class="view-actions">
             <button id="refreshIncome" class="btn icon-btn" title="Refresh Income Data">
  <i class="material-icons">refresh</i>
</button>
            </div>
          </div>
          <div id="incomeContent" class="view-content">
            <!-- Income data will be loaded here -->
          </div>
        </div>
        
        <!-- Recurring View - Initially Hidden -->
        <div id="recurringView" class="view">
        <div class="view-header">
          <h1><i class="material-icons">repeat</i> <span data-translate="recurring">Recurring</span></h1>
          <div class="view-actions">
            <button id="refreshRecurring" class="btn icon-btn" title="Refresh Recurring Transactions">
              <i class="material-icons">refresh</i></button>
          </div>
        </div>
        <div id="recurringContent" class="view-content">
          <!-- Recurring data will be loaded here by RecurringManager -->
        </div>
      </div>
              
        <!-- Net Worth View - Initially Hidden -->
       <!-- Net Worth View - Update these IDs -->
        <div id="netWorthView" class="view">
          <div class="view-header">
            <h1><i class="material-icons">trending_up</i> <span data-translate="net_worth_title">Net Worth</span></h1>
            <div class="view-actions">
              <!-- Month/Year Selector -->
              <div class="month-selector">
                <button id="prevMonthNetWorth" class="month-nav-btn" aria-label="Previous month">
                  <i class="material-icons">chevron_left</i>
                </button>
                <div id="monthYearDisplayNetWorth" class="month-year-display">
                  <!-- Will be populated by JS -->
                </div>
                <button id="nextMonthNetWorth" class="month-nav-btn" aria-label="Next month">
                  <i class="material-icons">chevron_right</i>
                </button>
              </div>
              <button id="refreshNetWorth" class="btn icon-btn" title="Refresh Net Worth Data">
                <i class="material-icons">refresh</i>
              </button>
            </div>
          </div>
          <div id="netWorthContent" class="view-content">
            <!-- Net Worth data will be loaded here -->
          </div>
        </div>
        
        <!-- Reports View - Initially Hidden -->
        <div id="reportsView" class="view">
          <div class="view-header">
            <h1><i class="material-icons">bar_chart</i> <span data-translate="reports">Reports</span></h1>
            <div class="view-actions">
              <button id="generateReport" class="btn primary"><i class="material-icons">download</i> <span data-translate="generate">Generate</span></button>
            </div>
          </div>
          <div id="reportsContent" class="view-content">
            <!-- Reports data will be loaded here -->
          </div>
        </div>
        
      <!-- Categories  -->
      <div id="categoriesView" class="view">
  <div class="view-header">
    <h1><i class="material-icons">category</i> <span data-translate="categories">Categories</span></h1>
    <div class="view-actions">
      <button id="refreshCategories" class="btn icon-btn" title="Refresh Categories">
  <i class="material-icons">refresh</i>
</button>
    </div>
  </div>
  <div id="categoriesContent" class="view-content">
    <div class="categories-header">
      <div id="category-counts" class="category-counts">
        Loading categories...
      </div>
    </div>
    <div id="categories-container" class="categories-container">
      <!-- Categories will be loaded here -->
      <div class="categories-loading">
        <div class="loading-spinner"></div>
        <p>Loading categories...</p>
      </div>
    </div>
  </div>
</div>
        
        <!-- Settings View - Initially Hidden -->
        <div id="settingsView" class="view">
          <div class="view-header">
            <h1><i class="material-icons">settings</i> <span data-translate="settings">Settings</span></h1>
            <!-- view-actions div removed - using autosave instead -->
          </div>
          <div id="settingsContent" class="view-content">
            <?!= include('Settings'); ?>
          </div>
        </div>



        </div>



 

      </div>
    
    

    </div>
    
    <!-- Include JavaScript -->
        <?!= include('settings.js'); ?>
     <?!= include('API'); ?>
      <?!= include('TransactionManager.js'); ?>
     <?!= include('Utils'); ?>
     <?!= include('Init'); ?>
     <?!= include('dashboard.js'); ?>
     <?!= include('transactionEntry.js'); ?>
     <?!= include('categories.js'); ?> 
     <?!= include('monthlyGrid.js'); ?>
     <?!= include('income.js'); ?>
     <?!= include('recurring.js'); ?>
     <?!= include('networth.js.html'); ?>
 




    

<script>
  // Main entry point - Initialize the application
  document.addEventListener('DOMContentLoaded', function() {
    SimBudget.initialize();
    // REMOVED: The setTimeout that was forcing expenses view
    // Now the initialize function handles view selection with session persistence
  });


    // Direct binding for refresh button that bypasses all the complexity
  document.addEventListener('DOMContentLoaded', function() {
    const refreshBtn = document.getElementById('refreshExpenses');
    if (refreshBtn) {
      refreshBtn.addEventListener('click', function() {
        console.log('Manual refresh triggered');
        
        // Reset session tracking
        sessionStorage.removeItem('monthlyGrid_sessionActive');
        
        // Signal fresh data needed
        window.FORCE_FRESH_DATA = true;
        
        // Force refresh with hard reload
        if (window.MonthlyGrid && typeof MonthlyGrid.refresh === 'function') {
          MonthlyGrid.refresh();
        }
      });
    }
  });
</script>

  </body>
</html>